<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Characters{% endblock %}</title>
  <link rel="stylesheet" href="../templates/common-card-styles.css">
</head>
<body>

{% macro dots(val, max) %}
  {% set v = (val is defined and val is not same as(false) and val is not same as('')) ? (val) : 0 %}
  {% set m = max is defined ? max : 5 %}
  <span class="rating">
    {% for i in 1..m %}
      {% if i <= v %}<span class="filled">‚óè</span>{% else %}<span class="empty">‚óã</span>{% endif %}
    {% endfor %}
  </span>
{% endmacro %}

{% macro columnBlockStats(title, data, stats, maxRatings) %}
  {% import _self as R %}
  <div class="stat-group col">
    <h3>{{ title }}</h3>
    <div class="stat-row">
      {% for statName in stats %}
        <div class="stat-label">{{ statName }}</div>
        <div class="stat-value">{{ R.dots(data[statName], maxRatings) }}</div>
      {% endfor %}
    </div>
  </div>
{% endmacro %}

{% import _self as R %}

{% set WoundPenalties = [0, -1, -2, -4] %}

<div class="grid">
  {% for card in cards %}
  {% for WoundPenalty in WoundPenalties %}
  {% set max_rating = max(5, card.Essence) %}
  {% set max_essence = max(5, card.Essence) %}
  {% set max_willpower = 10 %}
  {% set max_virtue = 5 %}
  <div class="card size-big">
    <div class="card-content">
      <div class="card-header default">
        <div class="card-title">
          {{ card.Name }}
          {% for i in WoundPenalty..0 %}
            <span class="filled">ü©∏</span>
          {% endfor %}
        </div>
        {% if card.Caste %}<div class="badge primary">{{ card.Caste }}</div>{% endif %}
        {% if card.Concept %}<div class="badge secondary">{{ card.Concept }}</div>{% endif %}
      </div>

      <div class="card-body">
        <div class="grid grid-3">
          {{ R.columnBlockStats("Core", card, ["Essence", "Willpower"], 10) }}
          {{ R.columnBlockStats("Physical", card.Attributes, ["Strength", "Dexterity", "Stamina"], max_rating) }}
          {{ R.columnBlockStats("Social", card.Attributes, ["Charisma", "Manipulation", "Appearance"], max_rating) }}
          {{ R.columnBlockStats("Mental", card.Attributes, ["Perception", "Intelligence", "Wits"], max_rating) }}
          {{ R.columnBlockStats("Virtues", card.Virtues, ["Compassion", "Conviction", "Temperance", "Valor"], max_virtue) }}
          {{ R.columnBlockStats("Dawn", card.Abilities, ["Archery", "Thrown", "Martial Arts", "War", "Melee"], max_rating) }}
          {{ R.columnBlockStats("Night", card.Abilities, ["Archery", "Thrown", "Martial Arts", "War", "Melee"], max_rating) }}
          {{ R.columnBlockStats("Eclipse", card.Abilities, ["Archery", "Thrown", "Martial Arts", "War", "Melee"], max_rating) }}
          {{ R.columnBlockStats("Twilight", card.Abilities, ["Archery", "Thrown", "Martial Arts", "War", "Melee"], max_rating) }}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
  {% endfor %}
</div>